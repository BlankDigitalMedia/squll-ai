import{d as z,p as I,s as x,a as k,o as X,f as Y,b as D,t as T,c as U,e as V,g as e,h as m,l as q,i as A,j,m as M,k as _,P as F,n as C}from"./Panel-DizNDRna.js";var N=Y('<button tabindex="0" aria-label="Toggle note panel">B</button>');function S(i,t){I(t,!0);let d=x(null),p=x(!1),y=x(!1),a=x(k({x:0,y:0})),w=x(k({x:0,y:0})),r=x(null),u=k({x:0,y:0});function s(o){if(!e(d))return;m(p,!0),m(y,!1);const v=e(d).getBoundingClientRect();m(a,{x:o.clientX-v.left,y:o.clientY-v.top},!0),m(w,{x:o.clientX,y:o.clientY},!0),o.preventDefault(),o.stopPropagation()}function c(o){if(e(p)&&e(d)&&e(r)){const v=o.clientX-e(a).x,f=o.clientY-e(a).y,B=56,R=Math.max(0,Math.min(v,window.innerWidth-B)),P=Math.max(0,Math.min(f,window.innerHeight-B));(Math.abs(o.clientX-e(w).x)>5||Math.abs(o.clientY-e(w).y)>5)&&m(y,!0),u.x=R,u.y=P,e(r).style.left=`${R}px`,e(r).style.top=`${P}px`}}function l(){e(p)&&e(r)&&u.x!==void 0&&u.y!==void 0&&j({x:u.x,y:u.y}),m(p,!1)}function n(o){!e(y)&&t.onToggle&&t.onToggle(),m(y,!1)}X(()=>{if(m(r,document.getElementById("button-root"),!0),!!e(r))return q().then(o=>{const f={...{x:window.innerWidth*.02,y:window.innerHeight*.9},...o};f.x!==void 0&&f.y!==void 0&&(u.x=f.x,u.y=f.y,e(r).style.left=`${f.x}px`,e(r).style.top=`${f.y}px`)}),document.addEventListener("mousemove",c),document.addEventListener("mouseup",l),()=>{document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",l)}});var h=N();let $;h.__mousedown=s,h.__click=n,D(h,o=>m(d,o),()=>e(d)),T(()=>$=A(h,1,"floating-button svelte-1q8htkr",null,$,{dragging:e(p)})),U(i,h),V()}z(["mousedown","click"]);let H=null,g=null,E=null;function b(i){E&&(E.style.display=i?"block":"none")}function W(){if(g)return;const i=document.getElementById("extension-root");if(i&&i.shadowRoot){g=i,i.shadowRoot;const s=document.getElementById("button-root");if(s&&(E=s,(!s.style.left||!s.style.top)&&(s.style.left=`${window.innerWidth*.02}px`,s.style.top=`${window.innerHeight*.9}px`),!H&&s.shadowRoot&&s.shadowRoot.childNodes.length===0)){const c=s.shadowRoot;if(!Array.from(c.querySelectorAll("link")).some(h=>h.href.includes("content-script.css"))){const h=document.createElement("link");h.rel="stylesheet",h.href=chrome.runtime.getURL("content-script.css"),c.appendChild(h)}const n=document.createElement("div");n.style.pointerEvents="auto",c.appendChild(n),H=M(S,{target:n,props:{onToggle:()=>{L()}}})}_().then(c=>{const n={...{x:window.innerWidth*.15,y:window.innerHeight*.1,width:window.innerWidth*.49,height:window.innerHeight*.8,visible:c.visible!==void 0?c.visible:!0},...c};n.x!==void 0&&n.y!==void 0&&(i.style.left=`${n.x}px`,i.style.top=`${n.y}px`),n.width!==void 0&&n.height!==void 0&&(i.style.width=`${n.width}px`,i.style.height=`${n.height}px`),i.style.display=n.visible?"block":"none",b(!n.visible),c.minimized&&b(!0)});return}const t=document.createElement("div");t.id="extension-root",t.style.position="fixed",t.style.zIndex="2147483647",t.style.pointerEvents="none",document.documentElement.appendChild(t);const d=t.attachShadow({mode:"open"}),p=document.createElement("link");p.rel="stylesheet",p.href=chrome.runtime.getURL("content-script.css"),d.appendChild(p);const y=document.createElement("div");y.style.pointerEvents="auto",y.style.width="100%",y.style.height="100%",d.appendChild(y);const a=document.createElement("div");a.id="button-root",a.style.position="fixed",a.style.zIndex="2147483647",a.style.pointerEvents="none",a.style.left=`${window.innerWidth*.02}px`,a.style.top=`${window.innerHeight*.9}px`,document.documentElement.appendChild(a);const w=a.attachShadow({mode:"open"}),r=document.createElement("link");r.rel="stylesheet",r.href=chrome.runtime.getURL("content-script.css"),w.appendChild(r);const u=document.createElement("div");u.style.pointerEvents="auto",w.appendChild(u),E=a,H=M(S,{target:u,props:{onToggle:()=>{L()}}}),g=t,_().then(s=>{const l={...{x:window.innerWidth*.15,y:window.innerHeight*.1,width:window.innerWidth*.49,height:window.innerHeight*.8,visible:s.visible!==void 0?s.visible:!0},...s};l.x!==void 0&&l.y!==void 0&&(t.style.left=`${l.x}px`,t.style.top=`${l.y}px`),l.width!==void 0&&l.height!==void 0&&(t.style.width=`${l.width}px`,t.style.height=`${l.height}px`),t.style.display=l.visible?"block":"none",M(F,{target:y,props:{onLayoutChange:n=>{C(n)},onMinimize:()=>{L()}}}),b(!l.visible)})}function L(){if(!g){W();return}const t=!(g.style.display!=="none");if(t)C({visible:!0,minimized:!1});else{const d=g.getBoundingClientRect();C({x:d.left,y:d.top,width:d.width,height:d.height,visible:t,minimized:!0})}g.style.display=t?"block":"none",b(!t)}chrome.runtime.onMessage.addListener(i=>(i.type==="toggle-panel"&&L(),!0));W();
